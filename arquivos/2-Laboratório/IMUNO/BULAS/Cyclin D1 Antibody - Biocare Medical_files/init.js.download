console.log('FulcrumSaaS: v2.3 2020-06-02 20:24:06');

function fulcrumsaas_fcsid() {
    var name = "fulcrum_csid=";
    var ca = document.cookie.split(';');
    for(var i = 0; i < ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0) == ' ') {
            c = c.substring(1);
        }
        if (c.indexOf(name) == 0) {
            return c.substring(name.length, c.length);
        }
    }

    var id = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {var r = Math.random()*16|0,v=c=='x'?r:r&0x3|0x8;return v.toString(16);});
    var d = new Date();
    var dm = document.domain.split('.');
    var dmt = dm.pop();
    dmt = dm.pop() + '.' + dmt;
    d.setTime(d.getTime() + (99 * 365 * 24 * 60 * 60 * 1000));
    var expires = "expires="+d.toUTCString();
    document.cookie = "fulcrum_csid=" + id + ";" + expires + ";path=/;domain="+dmt;
    return id;
}

(function(w,d,f){w[f] = function(z){

    function fulcrumsaas_call(cb,call_url,call_zid) {

        var xhr = new XMLHttpRequest();

        xhr.open('GET', call_url, true);
        xhr.withCredentials = true;
        xhr.send();

        xhr.onload = function() {
            cb(null, xhr.responseText,call_zid);
        };

        xhr.onerror = function () {
            cb(true, xhr.responseText, call_zid);
        };

        return xhr;
    }

    var fulcrumsaas_csid = fulcrumsaas_fcsid();

    // dev control panel 

    if(Object.keys(z.zones).length > 0){
        for(var zid in z.zones){
            var match = false;
            var path = w.location.host+w.location.pathname+w.location.search+w.location.hash;
            for(var match_type in z.zones[zid].match){
                for(var mindex in z.zones[zid].match[match_type]){
                    var pattern = z.zones[zid].match[match_type][mindex];
                    switch(match_type){
                        case 'includes':
                            if(path.includes(pattern)){ match = true;}
                            break;
                        case 'host.pattern':
                            if(w.location.host.includes(pattern)){ match = true; }
                            break;
                        case 'host.equals':
                            if(w.location.host == pattern){ match = true; }
                            break;
                        case 'path.pattern':
                            if(w.location.pathname.includes(pattern)){ match = true; }
                            break;
                        case 'path.equals':
                            if(w.location.pathname == pattern){ match = true; }
                            break;
                        case 'search':
                            if(w.location.search.includes(pattern)){ match = true; }
                            break;
                        case 'hash':
                            if(w.location.hash.includes(pattern)){ match = true; }
                            break;
                    }
                }                
            }
         
            if(match == true){

                var zdiv = d.getElementById('fulcrumsaas_z_'+zid);
                if(!zdiv){
                    bdid = document.getElementsByTagName("BODY")[0];
                    var zdiv = document.createElement("div");
                    bdid.prepend(zdiv);
                    zdiv.setAttribute("id", 'fulcrumsaas_z_'+zid);
                }

                fulcrumsaas_call(function( err, resp, call_zid ) {
                    if(!err){
                        zdiv.innerHTML = resp;
                        switch(call_zid){
                                                    }
                    }else{
                        console.log(err);
                    }
                },'//api.fulcrumsaas.net/zonerule/fud6mgf1v0/'+zid+'/'+fulcrumsaas_csid,zid);
            }
        }
    }

}})(window, document, 'fulcrumsaas_init');

fulcrumsaas_init({"zones":[]});

(function(w,d,f){w[f] = function(i,p){
    
    var params = p;
    params._fcsid = fulcrumsaas_fcsid();
    params._referrer = d.referrer;
    params._interaction = i;

    var report = {
        path: w.location.href,
        campaign_id: "fud6mgf1v0",
        params: params
    };

    CORS('POST', '//log.fulcrumsaas.net/log/2.0', report, function( err, resp ) {
        if(!err){
            console.log(resp);
        }else{
            console.log(err);
            console.log(resp);
        }
    });

    function CORS(method, url, data, cb) {

        var xhr = new XMLHttpRequest();

        if ("withCredentials" in xhr) {
            xhr.open(method, url, true);
        } else if (typeof XDomainRequest != "undefined") {
            xhr = new XDomainRequest();
            xhr.open(method, url);
        } else {
            xhr = null;
        }

        xhr.withCredentials = true;
        xhr.send(JSON.stringify(data));

        xhr.onload = function() {
            cb(null, xhr.responseText);
        };

        xhr.onerror = function () {
            cb(true, xhr.responseText);
        };

        return xhr;
    }

}})(window, document, 'fulcrum_wedge');

fulcrum_wedge('view',window['fulcrum'].p);

function fulcrum_event(p){
    fulcrum_wedge('event',JSON.parse(p));
}




