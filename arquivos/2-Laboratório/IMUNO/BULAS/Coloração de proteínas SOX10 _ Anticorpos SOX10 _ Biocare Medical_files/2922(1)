!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define(t):t()}(0,function(){"use strict";function e(e){var t=this.constructor;return this.then(function(r){return t.resolve(e()).then(function(){return r})},function(r){return t.resolve(e()).then(function(){return t.reject(r)})})}function t(e){return!(!e||void 0===e.length)}function r(){}function n(e){if(!(this instanceof n))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],c(e,this)}function o(e,t){for(;3===e._state;)e=e._value;0!==e._state?(e._handled=!0,n._immediateFn(function(){var r=1===e._state?t.onFulfilled:t.onRejected;if(null!==r){var n;try{n=r(e._value)}catch(e){return void a(t.promise,e)}i(t.promise,n)}else(1===e._state?i:a)(t.promise,e._value)})):e._deferreds.push(t)}function i(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var r=t.then;if(t instanceof n)return e._state=3,e._value=t,void u(e);if("function"==typeof r)return void c(function(e,t){return function(){e.apply(t,arguments)}}(r,t),e)}e._state=1,e._value=t,u(e)}catch(t){a(e,t)}}function a(e,t){e._state=2,e._value=t,u(e)}function u(e){2===e._state&&0===e._deferreds.length&&n._immediateFn(function(){e._handled||n._unhandledRejectionFn(e._value)});for(var t=0,r=e._deferreds.length;r>t;t++)o(e,e._deferreds[t]);e._deferreds=null}function c(e,t){var r=!1;try{e(function(e){r||(r=!0,i(t,e))},function(e){r||(r=!0,a(t,e))})}catch(e){if(r)return;r=!0,a(t,e)}}var s=setTimeout;n.prototype.catch=function(e){return this.then(null,e)},n.prototype.then=function(e,t){var n=new this.constructor(r);return o(this,new function(e,t,r){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=r}(e,t,n)),n},n.prototype.finally=e,n.all=function(e){return new n(function(r,n){function o(e,t){try{if(t&&("object"==typeof t||"function"==typeof t)){var u=t.then;if("function"==typeof u)return void u.call(t,function(t){o(e,t)},n)}i[e]=t,0==--a&&r(i)}catch(e){n(e)}}if(!t(e))return n(new TypeError("Promise.all accepts an array"));var i=Array.prototype.slice.call(e);if(0===i.length)return r([]);for(var a=i.length,u=0;i.length>u;u++)o(u,i[u])})},n.resolve=function(e){return e&&"object"==typeof e&&e.constructor===n?e:new n(function(t){t(e)})},n.reject=function(e){return new n(function(t,r){r(e)})},n.race=function(e){return new n(function(r,o){if(!t(e))return o(new TypeError("Promise.race accepts an array"));for(var i=0,a=e.length;a>i;i++)n.resolve(e[i]).then(r,o)})},n._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){s(e,0)},n._unhandledRejectionFn=function(e){void 0!==console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)};var f=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw Error("unable to locate global object")}();"Promise"in f?f.Promise.prototype.finally||(f.Promise.prototype.finally=e):f.Promise=n}),function(e,t){"function"==typeof define&&define.amd?define([],function(){return e.CallTrack=t()}):e.CallTrack=t()}("undefined"!=typeof self?self:this,function(){Array.prototype.findIndex=Array.prototype.findIndex||function(e){if(null===this)throw new TypeError("Array.prototype.findIndex called on null or undefined");if("function"!=typeof e)throw new TypeError("callback must be a function");for(var t=Object(this),r=t.length>>>0,n=arguments[1],o=0;o<r;o++)if(e.call(n,t[o],o,t))return o;return-1};var e={association:2922,active:true,regex:"$1-$2-$3",continuousNumberSwap:false,rules:[{"replace":"+18555049997","type":"search","match":"all","matchValue":"organic-all","number":["800-799-9499"],"ref":"b977207b-c755-45f5-b1c3-2ba9244542b7"},{"replace":"+18557130271","type":"search","match":"all","matchValue":"paid-all","number":["800-799-9499"],"ref":"38cb84c6-00a3-45d6-88a0-34f5ddcfafb2"}],brandedTerms:["biocare"],ignoredIPs:[""],imgPath:"",numbersToReplace:[],socialSites:{facebook:["facebook.com","fb.com","test.facebook.com"],twitter:["twitter.com","t.co"],linkedin:["linkedin.com","lnkd.in"],instagram:["instagram.com"],pinterest:["pinterest.com"],"google+":["googleplus.com","plus.google.com"],youtube:["youtube.com"],tumblr:["tumblr.com"],yelp:["yelp.com"]},ga:{term:null,source:null,medium:null},referrer:void 0,init:function(){if(this.active&&(this.parseRules=this.parseRules.bind(this),this.replace=this.replace.bind(this),this.parseInfo=this.parseInfo.bind(this),this.referrer=e._.getReferrer(),this.info().then(this.parseInfo).then(this.parseRules).then(this.replace),this.continuousNumberSwap)){var t=document.body.innerHTML;setInterval(function(){t!=document.body.innerHTML&&(t=document.body.innerHTML,e.replace())},5e3)}},info:function(){var e=this;return new Promise(function(t,r){var n=e.Cookie.get("fx_info",!0);!n||e._.getUrlParameter("gclid")?e._.ajax({type:"POST",url:("https:"==document.location.protocol?"https://":"http://")+"us-east1-idyllic-vehicle-159522.cloudfunctions.net/mcfx-visitor-information",data:JSON.stringify({referrer:e.referrer}),headers:{"Content-Type":"application/json"}}).then(function(r){var n=JSON.parse(r);e.Cookie.set("fx_info",n,{expires:7}),t(n)},function(e){r(e)}):t(n)})},parseInfo:function(t){e.ga=t;var r=e._.getUrlParameter("utm_source"),n=e._.getUrlParameter("utm_medium");return r?(e.ga.source=r,e.Cookie.set("utm_source",r,{expires:1})):e.Cookie.get("utm_source")&&(e.ga.source=e.Cookie.get("utm_source")),n?(e.ga.medium=n,e.Cookie.set("utm_source",n,{expires:1})):e.Cookie.get("utm_medium")&&(e.ga.medium=e.Cookie.get("utm_medium")),e.ga},parseRules:function(){var t=e.Cookie.get("MCFXNumberSwap",!0);if(t)return e.numbersToReplace=e.addRegexRules(t),t;var r=[],n=[];return e.rules.forEach(function(t){-1===r.findIndex(function(e){return e===t.number.join(":")})&&e.matchRule(t)&&(n.push(t),r.push(t.number.join(":")))}),e.Cookie.set("MCFXNumberSwap",n,{expires:7}),e.numbersToReplace=e.addRegexRules(n),n},matchRule:function(t){switch(t.type){case"referrer":return e.matchReferrer(t);case"search":return e.matchSearch(t);case"social":return e.matchSocial(t);case"landingPage":return e.matchLandingPage(t);case"urlParam":case"landingParam":return e.matchUrlParam(t);case"cookie":return e.matchCookie(t);case"direct":return e.isDirect(t);case"source":return e.matchSource(t);case"region":return e.matchRegion(t);case"city":return e.matchCity(t);case"country":return e.matchCountry(t)}},replace:function(t){if(0!==t.length&&!(e.ignoredIPs.length>0&&-1!==e.ignoredIPs.indexOf(e.ga.ip))){var r=document.querySelector("body");if(r){for(var n=document.createNodeIterator(r,NodeFilter.SHOW_TEXT,e.testNode,!0),o=n.nextNode();o;)o=n.nextNode();var i=document.querySelectorAll(".img-phone-swap");i.forEach(function(t){t.setAttribute("src",e.numbersToReplace[0].imgPath)})}else e.continuousNumberSwap||setTimeout(function(){e.replace(t)},100)}},testNode:function(t){if(3!==t.nodeType)return NodeFilter.FILTER_SKIP;for(var r=0;r<e.numbersToReplace.length;r++){for(var n=e.numbersToReplace[r],o=!1,i=0;i<n.number.length;i++)if(!n.number[i]||null===n.number[i]||""===n.number[i]||n.number[i].length<2){o=!0;break}if(!o&&n.search.test(t.textContent)){"queue"===n.replace.toLowerCase()?(e.Queue.type=n.type,e.Queue.getNumber().then(function(t){if(t)return e.Queue.modifyReplacement(t,r)}).then(function(r){e.modifyNode(t,r)})):e.modifyNode(t,n);break}}return NodeFilter.FILTER_ACCEPT},modifyNode:function(e,t){if(e.nodeValue=e.nodeValue.replace(t.search,t.replace),void 0!==e.parentElement&&null!==e.parentElement){var r=e.parentElement.getAttribute("href");null!==r&&"tel:"===r.substr(0,4)&&e.parentElement.setAttribute("href","tel:"+t.tel)}},addRegexRules:function(t){var r=/^\D?(\d{3})\D?\D?(\d{3})\D?(\d{4})/;return t.map(function(t){if("queue"===t.replace.toLowerCase)return t;var n=t.replace.replace("+1","");t.search=new RegExp(t.number.join("|").replace(/(?=[()+ ])/g,"\\"),"gi"),t.replace=n.replace(r,e.regex),t.tel="+1"+n.replace(r,"$1$2$3");var o=""===e.imgPath||"/"!==e.imgPath[e.imgPath.length-1]?e.imgPath+"/":e.imgPath;return t.imgPath=o+n.replace(r,"$1$2$3")+".png",t})},isOrganic:function(){return"organic"===e.ga.medium},isDirect:function(){return"direct"===e.ga.source},isBranded:function(){if(null!=e.ga)for(var t=0;t<e.brandedTerms.length;t++)if(-1!=e.ga.term.toLowerCase().indexOf(e.brandedTerms[t].toLowerCase()))return!0;return!1},isPPC:function(){return"ppc"===e.ga.medium},matchReferrer:function(t){return"all"===t.match||null!=e.referrer&&-1!=e.referrer.indexOf(t.match)},matchSearch:function(t){return!!(e.matchSource(t)&&e.matchMedium(t)&&e.matchSegment(t))},matchMedium:function(t){var r=t.match;if(void 0!==t.matchValue){var n=t.matchValue.split("-");r=n[0].trim()}return"all"===r||("organic"===r?e.isOrganic():"paid"===r||"ppc"===r?e.isPPC():"notprov"===r?e.matchSegment("notprov"):void 0)},matchSegment:function(t){var r=t.match;if(void 0!==t.matchValue){var n=t.matchValue.split("-");r=n[1].trim()}return"all"===r||("branded"===r?e.isBranded():"unbranded"===r?!e.isBranded():"notprov"===r?"not provided"===e.ga.term:"not provided"!==e.ga.term&&void 0)},matchSocial:function(t){if(!e.referrer||""==e.referrer)return!1;var r=e.referrer.split("/")[2];if(r=r.replace(/^www\./i,""),!r||""==r)return!1;if("all"!==t.match)return-1!==e.socialSites[t.match].findIndex(function(e){return e===r});for(var n in e.socialSites)if(-1!==e.socialSites[n].findIndex(function(e){return e===r}))return!0;return!1},matchLandingPage:function(e){return window.location.pathname==e.match},matchUrlParam:function(t){var r=e._.getUrlParameter(t.match);return null!==r&&(""===r||-1!==r.indexOf(t.matchValue))},matchCookie:function(t){var r=e.Cookie.get(t.match);return null!==r&&(""===r||-1!==r.indexOf(t.matchValue))},matchRegion:function(t){return"equals"!==t.matchValue?t.match.toLowerCase()!==e.ga.location.region:t.match.toLowerCase()===e.ga.location.region},matchCity:function(t){var r,n,o=t.match.toLowerCase().split(",");return"equals"!==t.matchValue?2===o.length?(r=o[0].toLowerCase().trim()===e.ga.location.city,n=o[1].toLowerCase().trim()===e.ga.location.city,!r||!n):o[0].toLowerCase().trim()!==e.ga.location.city:2===o.length?(r=o[0].toLowerCase().trim()===e.ga.location.city,n=o[1].toLowerCase().trim()===e.ga.location.city,r&&n):o[0].toLowerCase().trim()===e.ga.location.city},matchCountry:function(t){return"equals"!==t.matchValue?t.match.toUpperCase()!==e.ga.location.country:t.match.toUpperCase()===e.ga.location.country},matchSource:function(t){return"all"===t.match||e.ga.source==t.match},Cookie:{converter:function(){},defaults:{path:"/"},set:function(t,r,n){if("undefined"!=typeof document){n=e.Cookie.extend({domain:"."+e._.getDomainName()},e.Cookie.defaults,n),"number"==typeof n.expires&&(n.expires=new Date(1*new Date+864e5*n.expires)),n.expires=n.expires?n.expires.toUTCString():"";try{var o=JSON.stringify(r);/^[\{\[]/.test(o)&&(r=o)}catch(e){}r=e.Cookie.converter.write?e.Cookie.converter.write(r,t):encodeURIComponent(String(r)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var i="";for(var a in n)n[a]&&(i+="; "+a,!0!==n[a]&&(i+="="+n[a].split(";")[0]));return document.cookie=t+"="+r+i}},get:function(t,r){if("undefined"!=typeof document){for(var n={},o=document.cookie?document.cookie.split("; "):[],i=0;i<o.length;i++){var a=o[i].split("="),u=a.slice(1).join("=");r||'"'!==u.charAt(0)||(u=u.slice(1,-1));try{var c=e.Cookie.decode(a[0]);if(u=(e.Cookie.converter.read||e.Cookie.converter)(u,c)||e.Cookie.decode(u),r)try{u=JSON.parse(u)}catch(e){}if(n[c]=u,t===c)break}catch(e){}}return t?n[t]:n}},extend:function(){for(var e=0,t={};e<arguments.length;e++){var r=arguments[e];for(var n in r)t[n]=r[n]}return t},decode:function(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}},Queue:{type:null,getNumber:function(){return new Promise(function(t,r){e._.ajax({type:"POST",url:("https:"==document.location.protocol?"https://":"http://")+"api.leadmanagerfx.com/phonelease/get/"+e.association,data:e.Queue.generateUniqueRequest(),headers:{"Content-type":"application/x-www-form-urlencoded"}}).then(function(r){r=JSON.parse(r);var n=r.expires,o=r.number;e.Cookie.set("ctfxExpires",n,{expires:730}),t(o)},function(e){r(e)})})},modifyReplacement:function(t,r){var n=e.Cookie.get("MCFXNumberSwap",!0);return n[r].replace=t,e.Cookie.set("MCFXNumberSwap",n,{expires:7}),e.numbersToReplace=e.addRegexRules(n),n[r]},generateUniqueRequest:function(){var t=null;if(null==e.Cookie.get("ctfxRequest")||e.Queue.isExpired()){var r=Number(e.Cookie.get("fx_count")),n=e.Cookie.get("fx_uuid"),o=e.Queue.type,i="";i+="ga_count="+r+"&",i+="ga_id="+n+"&",i+="page="+window.location.href.replace(/^(?:\/\/|[^\/]+)*/,"")+"&",i+="&fx_document_title="+encodeURIComponent(document.title),i+="&fx_referrer="+encodeURIComponent(e._.getReferrer()),i+="&type="+o,e.Cookie.set("ctfxRequest",i,{expires:730}),t=i}else t=e.Cookie.get("ctfxRequest");return t},isExpired:function(){var t=e.Cookie.get("ctfxExpires");return null==t||parseInt((new Date).getTime()/1e3)-parseInt(t)>0}},_:{getUrlParameter:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),r=t.exec(location.search);return null===r?null:decodeURIComponent(r[1].replace(/\+/g," "))},getReferrer:function(){var t=document.referrer,r=e.Cookie.get("fx_referrer");return null!=r?t=r:e.Cookie.set("fx_referrer",t,{expires:7}),t},ajax:function(e){return e.type=e.type.toUpperCase()||"GET",new Promise(function(t,r){var n=new XMLHttpRequest;n.open(e.type,e.url),e.headers&&Object.keys(e.headers).forEach(function(t){n.setRequestHeader(t,e.headers[t])}),n.onload=function(){200==n.status?t(n.response):r(Error(n.statusText))},n.onerror=function(){r(Error("Network Error"))},e.data?n.send(e.data):n.send()})},uuid4:function(t,r,n){var o=r&&n||0;"string"==typeof t&&(r="binary"===t?new Array(16):null,t=null),t=t||{};var i=t.random||(t.rng||e._.rng)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,r)for(var a=0;a<16;++a)r[o+a]=i[a];return r||e._.bytesToUuid(i)},bytesToUuid:function(e,t){if(!this.byteToHex){this.byteToHex=[];for(var r=0;r<256;++r)this.byteToHex[r]=(r+256).toString(16).substr(1)}r=t||0;var n=this.byteToHex;return[n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]]].join("")},rng:function(){var e="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(e){var t=new Uint8Array(16);return e(t),t}for(var r,n=new Array(16),o=0;o<16;o++)0==(3&o)&&(r=4294967296*Math.random()),n[o]=r>>>((3&o)<<3)&255;return n},getDomainName:function(){if(void 0!==e._.domain&&""!==e._.domain)return e._.domain;for(var t=0,r=document.domain,n=r.split("."),o="_gd"+(new Date).getTime();t<n.length-1&&-1==document.cookie.indexOf(o+"="+o);)r=n.slice(-1-++t).join("."),document.cookie=o+"="+o+";domain="+r+";";return document.cookie=o+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;domain="+r+";",e._.domain=r,e._.domain}}};return e.init(),e});